/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * JdlgCambiarOperador.java
 *
 * Created on 13/03/2014, 02:00:36 PM
 */
package com.estrellaroja.confirmacionviajes.forms;

import com.estrellaroja.confirmacionviajes.entidades.TmsTarjetasViaje;
import com.estrellaroja.confirmacionviajes.solicitudes.TmsOperadorFacadeRemote;
import java.awt.Color;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import javax.swing.JRootPane;

/**
 *
 * @author EKS Victor
 */
public class JdlgCambiarVentaManual extends javax.swing.JDialog {

  /** Creates new form JdlgCambiarOperador */
  public JdlgCambiarVentaManual(TmsTarjetasViaje tarjeta) {
    this.tarjeta = tarjeta;
    setDefaultLookAndFeelDecorated(true);
    this.setUndecorated(true);
    initComponents();
    this.getRootPane().setWindowDecorationStyle(JRootPane.INFORMATION_DIALOG);
    fillFields(tarjeta);
    pack();
    setLocationRelativeTo(null);
    jtxtBoletosVentaManual.requestFocus();
  }

  /** This method is called from within the constructor to
   * initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is
   * always regenerated by the Form Editor.
   */
  @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jlblFolio = new javax.swing.JLabel();
        jtxtFolio = new javax.swing.JTextField();
        jlblCorrida = new javax.swing.JLabel();
        jtxtCorrida = new javax.swing.JTextField();
        jlblFecha = new javax.swing.JLabel();
        jtxtFecha = new javax.swing.JTextField();
        jlblHora = new javax.swing.JLabel();
        jtxtHora = new javax.swing.JTextField();
        jlblAutobus = new javax.swing.JLabel();
        jtxtAutobus = new javax.swing.JTextField();
        jlblServicio = new javax.swing.JLabel();
        jtxtServicio = new javax.swing.JTextField();
        jlblOrigen = new javax.swing.JLabel();
        jtxtOrigen = new javax.swing.JTextField();
        jlblDestino = new javax.swing.JLabel();
        jtxtDestino = new javax.swing.JTextField();
        jblBoletosVentaManual = new javax.swing.JLabel();
        jtxtBoletosVentaManual = new tms_TextFields.JNumberTextField();
        jlblImporteVentaManual = new javax.swing.JLabel();
        jtxtImporteVentaManual = new tms_TextFields.JCuantityTextField();
        jcmdGuardar = new javax.swing.JButton();
        jcmdCancelar = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Cambiar Operador");
        setModal(true);
        setResizable(false);

        jlblFolio.setText("Folio:");

        jtxtFolio.setEditable(false);

        jlblCorrida.setText("Corrida:");

        jtxtCorrida.setEditable(false);

        jlblFecha.setText("Fecha:");

        jtxtFecha.setEditable(false);

        jlblHora.setText("Hora:");

        jtxtHora.setEditable(false);

        jlblAutobus.setText("Autobus:");

        jtxtAutobus.setEditable(false);

        jlblServicio.setText("Servicio:");

        jtxtServicio.setEditable(false);

        jlblOrigen.setText("Origen:");

        jtxtOrigen.setEditable(false);

        jlblDestino.setText("Destino:");

        jtxtDestino.setEditable(false);

        jblBoletosVentaManual.setLabelFor(jtxtBoletosVentaManual);
        jblBoletosVentaManual.setText("Boletos Venta Manual:");

        jlblImporteVentaManual.setLabelFor(jtxtImporteVentaManual);
        jlblImporteVentaManual.setText("Importe Venta Manual:");

        jcmdGuardar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/estrellaroja/confirmacionviajes/forms/images/accept.png"))); // NOI18N
        jcmdGuardar.setMnemonic('G');
        jcmdGuardar.setText("Guardar");
        jcmdGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jcmdGuardarActionPerformed(evt);
            }
        });

        jcmdCancelar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/estrellaroja/confirmacionviajes/forms/images/cancel.png"))); // NOI18N
        jcmdCancelar.setMnemonic('c');
        jcmdCancelar.setText("Cancelar");
        jcmdCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jcmdCancelarActionPerformed(evt);
            }
        });

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .addContainerGap()
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                    .add(layout.createSequentialGroup()
                        .add(jcmdGuardar)
                        .add(18, 18, 18)
                        .add(jcmdCancelar))
                    .add(layout.createSequentialGroup()
                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(jlblFolio)
                            .add(jlblCorrida)
                            .add(jlblFecha)
                            .add(jlblHora)
                            .add(jlblAutobus)
                            .add(jlblServicio)
                            .add(jlblOrigen)
                            .add(jlblDestino)
                            .add(jblBoletosVentaManual)
                            .add(jlblImporteVentaManual))
                        .add(69, 69, 69)
                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(jtxtImporteVentaManual, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 162, Short.MAX_VALUE)
                            .add(jtxtBoletosVentaManual, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 162, Short.MAX_VALUE)
                            .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                                .add(jtxtDestino)
                                .add(jtxtOrigen)
                                .add(jtxtServicio)
                                .add(jtxtAutobus)
                                .add(jtxtHora)
                                .add(jtxtFecha)
                                .add(jtxtCorrida)
                                .add(jtxtFolio, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 153, Short.MAX_VALUE)))))
                .addContainerGap(24, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(23, 23, 23)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jlblFolio)
                    .add(jtxtFolio, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jtxtCorrida, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jlblCorrida))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jtxtFecha, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jlblFecha))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jtxtHora, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jlblHora))
                .add(18, 18, 18)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jlblAutobus)
                    .add(jtxtAutobus, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 20, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(18, 18, 18)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jlblServicio)
                    .add(jtxtServicio, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(18, 18, 18)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jlblOrigen)
                    .add(jtxtOrigen, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(18, 18, 18)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jlblDestino)
                    .add(jtxtDestino, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(24, 24, 24)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jblBoletosVentaManual)
                    .add(jtxtBoletosVentaManual, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                    .add(layout.createSequentialGroup()
                        .add(18, 18, 18)
                        .add(jlblImporteVentaManual)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 23, Short.MAX_VALUE))
                    .add(layout.createSequentialGroup()
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jtxtImporteVentaManual, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .add(18, 18, 18)))
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jcmdCancelar)
                    .add(jcmdGuardar))
                .add(20, 20, 20))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jcmdCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jcmdCancelarActionPerformed
      dispose();
    }//GEN-LAST:event_jcmdCancelarActionPerformed

    private void jcmdGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jcmdGuardarActionPerformed
      if (validateInput()) {
        tarjeta.setBoletosVentaManual(jtxtBoletosVentaManual.getText());
        tarjeta.setImporteVentaManual(jtxtImporteVentaManual.getText());
        this.dispose();
      }else{
        new JdlgAdvertencia("Introdusca valores validos", "", "Confirmacion de Tarjetas de Viaje").setVisible(true);
      }
    }//GEN-LAST:event_jcmdGuardarActionPerformed
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel jblBoletosVentaManual;
    private javax.swing.JButton jcmdCancelar;
    private javax.swing.JButton jcmdGuardar;
    private javax.swing.JLabel jlblAutobus;
    private javax.swing.JLabel jlblCorrida;
    private javax.swing.JLabel jlblDestino;
    private javax.swing.JLabel jlblFecha;
    private javax.swing.JLabel jlblFolio;
    private javax.swing.JLabel jlblHora;
    private javax.swing.JLabel jlblImporteVentaManual;
    private javax.swing.JLabel jlblOrigen;
    private javax.swing.JLabel jlblServicio;
    private javax.swing.JTextField jtxtAutobus;
    private tms_TextFields.JNumberTextField jtxtBoletosVentaManual;
    private javax.swing.JTextField jtxtCorrida;
    private javax.swing.JTextField jtxtDestino;
    private javax.swing.JTextField jtxtFecha;
    private javax.swing.JTextField jtxtFolio;
    private javax.swing.JTextField jtxtHora;
    private tms_TextFields.JCuantityTextField jtxtImporteVentaManual;
    private javax.swing.JTextField jtxtOrigen;
    private javax.swing.JTextField jtxtServicio;
    // End of variables declaration//GEN-END:variables
  private TmsTarjetasViaje tarjeta;

  private void fillFields(TmsTarjetasViaje tarjeta) {
    SimpleDateFormat format = new SimpleDateFormat("HH:mm");
    jtxtFolio.setText(tarjeta.getFolioTarjeta());
    jtxtAutobus.setText(tarjeta.getAutobus());
    jtxtCorrida.setText(tarjeta.getClaveCorrida());
    jtxtDestino.setText(tarjeta.getDestino());
    jtxtOrigen.setText(tarjeta.getOrigen());
    jtxtServicio.setText(tarjeta.getServicio());
    jtxtFecha.setText(DateFormat.getDateInstance(DateFormat.MEDIUM).format(tarjeta.getFechaHoraCorrida()));
    jtxtHora.setText(format.format(tarjeta.getFechaHoraCorrida()));
    jtxtBoletosVentaManual.setText(tarjeta.getBoletosVentaManual());
    jtxtImporteVentaManual.setText(tarjeta.getImporteVentaManual());
  }

  private TmsOperadorFacadeRemote lookupTmsOperadoresFacade() {
    try {
      Context c = new InitialContext();
      return (TmsOperadorFacadeRemote) c.lookup("com.estrellaroja.confirmacionviajes.solicitudes.TmsOperadorFacadeRemote");

    } catch (NamingException ne) {
      // Logger.getLogger(getClass().getName()).log(Level.SEVERE,"exception caught" ,ne);
      throw new RuntimeException(ne);
    }
  }

  private boolean validateInput() {
    try {
      String sboletos = jtxtBoletosVentaManual.getText();
      if (sboletos.length() == 0) {
        jtxtBoletosVentaManual.requestFocus();
        jtxtBoletosVentaManual.setBackground(Color.red);
        return false;
      }
      int boletos = Integer.parseInt(sboletos);
      if (boletos > 100 || boletos == 0) {
        jtxtBoletosVentaManual.requestFocus();
        jtxtBoletosVentaManual.setBackground(Color.red);
        return false;
      }
    } catch (Exception e) {
      return false;
    }
    jtxtBoletosVentaManual.setBackground(Color.white);
    try {
      String simporte = jtxtImporteVentaManual.getText();
      if (simporte.length() == 0) {
        jtxtImporteVentaManual.requestFocus();
        jtxtImporteVentaManual.setBackground(Color.red);
        return false;
      }
      int ip = simporte.indexOf(".");
      if (ip > 0) {
        if (simporte.length() - ip > 3) {
          jtxtImporteVentaManual.requestFocus();
          jtxtImporteVentaManual.setBackground(Color.red);
          return false;
        }
      }
      float importe = Float.parseFloat(simporte);
      if (importe == 0.0) {
        jtxtImporteVentaManual.requestFocus();
        jtxtImporteVentaManual.setBackground(Color.red);
        return false;
      }
    } catch (Exception e) {
      return false;
    }
    jtxtImporteVentaManual.setBackground(Color.white);
    return true;
  }
}
