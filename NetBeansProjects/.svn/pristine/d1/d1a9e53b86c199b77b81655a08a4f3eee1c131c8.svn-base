/*
 * jdlg_bloqueo2.java
 *
 * Created on 31 de octubre de 2007, 11:32 AM
 */

package tms_global_login_recaudar;

import tms_encriptacion.EncriptarMD5;
import xertmsr.solicitud.TmsSesionGeneralRecaudaFacadeRemote;

/**
 *
 * @author  vgonzalez
 */
public class jdlg_bloqueo2 extends javax.swing.JDialog {
    
    /** Creates new form jdlg_bloqueo2 */
    public jdlg_bloqueo2(String titulo,TmsSesionGeneralRecaudaFacadeRemote psesionGeneralFacateRemote,String pUsuarioNumero, String pUsuarioContraseña) {
        this.setTitle(titulo);
        initComponents();
        this.setModal(true);
        this.setDefaultLookAndFeelDecorated(true);
        this.setAlwaysOnTop(true);
        initComponents();
        this.sesionGeneralFacateRemote = psesionGeneralFacateRemote;
        this.usuarioNumero = pUsuarioNumero;
        this.usuarioContraseña = pUsuarioContraseña;
        
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        jtxt_usuario = new tms_TextFields.JNumberTextField();
        jtxt_contraseña = new javax.swing.JPasswordField();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        jtxt_usuario.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jtxt_usuarioKeyPressed(evt);
            }
        });

        jtxt_contraseña.setText("jPasswordField1");
        jtxt_contraseña.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jtxt_contraseñaKeyPressed(evt);
            }
        });

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(136, 136, 136)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                    .add(org.jdesktop.layout.GroupLayout.LEADING, jtxt_contraseña, 0, 0, Short.MAX_VALUE)
                    .add(org.jdesktop.layout.GroupLayout.LEADING, jtxt_usuario, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 115, Short.MAX_VALUE))
                .addContainerGap(149, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(78, 78, 78)
                .add(jtxt_usuario, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(21, 21, 21)
                .add(jtxt_contraseña, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(159, Short.MAX_VALUE))
        );
        pack();
    }// </editor-fold>//GEN-END:initComponents

   private void aceptar(){
        String contraseña = "";
        try {
            contraseña = pwdEnc.encriptar(new String(jtxt_contraseña.getPassword()));
        } catch (Exception ex) {
            ex.printStackTrace();
        }
        if(jtxt_usuario.getText().equals(usuarioNumero)){
            if(contraseña.equals(usuarioContraseña))
             this.dispose();
            else
            {
                new jdlg_error("¡Número de usuario o contraseña no válido! ","Favor de intentarlo nuevamente","Datos invalidos").setVisible(true);
                jtxt_contraseña.setText("");
                jtxt_contraseña.requestFocus();
            }  
        }
            
        else
        {
            String respuesta = sesionGeneralFacateRemote.esUsuarioSupervisor(jtxt_usuario.getText(),contraseña,"1035");
            System.out.println("los datos para buscar al usuario son; Usuario: "+jtxt_usuario.getText()+"   Contraseña: "+contraseña);
            if(respuesta.equals("no encontrado"))
            {
                new jdlg_error("¡Número de usuario o contraseña no válido! ","Favor de intentarlo nuevamente","Datos invalidos").setVisible(true);
                jtxt_contraseña.setText("");
                jtxt_usuario.setText("");
                jtxt_usuario.requestFocus();
            }
            else{
            if(respuesta.equals("invalido"))
            {
                new jdlg_advertencia("¡Este usuario no tiene la función asignada!","Favor de contactar al administrador del sistema","Funcion no asignada").setVisible(true);
                jtxt_contraseña.setText("");
                jtxt_usuario.setText("");
                jtxt_usuario.requestFocus();
            }
            else
            {
                if(contraseña.equals(respuesta))
                    this.dispose();
                else
                {
                    new jdlg_error("¡Número de usuario o contraseña no válido! ","Favor de intentarlo nuevamente","Datos invalidos").setVisible(true);
                    jtxt_contraseña.setText("");
                    jtxt_usuario.setText("");
                    jtxt_usuario.requestFocus();
                }
            }
            }
        }
    }    
    
    
    private void jtxt_contraseñaKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jtxt_contraseñaKeyPressed
       if(evt.getKeyCode() == evt.VK_UP || evt.getKeyCode() == evt.VK_DOWN)
       {
           jtxt_usuario.requestFocus();
           jtxt_usuario.selectAll();
       }
        if(evt.getKeyCode() == evt.VK_ENTER)
        {
           String contra = new String(jtxt_contraseña.getPassword());
           if(contra.equals(""))
            {
                jtxt_usuario.selectAll();
                jtxt_usuario.requestFocus();
            }
            else
                if(jtxt_usuario.getText().equals(""))
                {
                  jtxt_usuario.selectAll();
                  jtxt_usuario.requestFocus();
                }
                else
                    aceptar();
        }            
    }//GEN-LAST:event_jtxt_contraseñaKeyPressed

    private void jtxt_usuarioKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jtxt_usuarioKeyPressed
      if(evt.getKeyCode() == evt.VK_UP || evt.getKeyCode() == evt.VK_DOWN)
      {
          jtxt_contraseña.requestFocus();
          jtxt_contraseña.selectAll();
      }
        if(evt.getKeyCode() == evt.VK_ENTER)
        {
          String contra = new String(jtxt_contraseña.getPassword());
          System.out.println("contraseña: "+contra);
          if(jtxt_usuario.getText().equals(""))
            {
                jtxt_contraseña.selectAll();
                jtxt_contraseña.requestFocus();
            }
            else
            {
                if(contra.equals(""))
                {
                 jtxt_contraseña.selectAll();
                 jtxt_contraseña.requestFocus(); 
                }
                else
                    aceptar();
            }
        }
        if(evt.getKeyCode() == evt.VK_ESCAPE)
            this.dispose();
    }//GEN-LAST:event_jtxt_usuarioKeyPressed
    
    /**
     * @param args the command line arguments
     
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new jdlg_bloqueo2(new javax.swing.JFrame(), true).setVisible(true);
            }
        });
    }*/
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPasswordField jtxt_contraseña;
    private tms_TextFields.JNumberTextField jtxt_usuario;
    // End of variables declaration//GEN-END:variables
    private TmsSesionGeneralRecaudaFacadeRemote sesionGeneralFacateRemote;
    private EncriptarMD5 pwdEnc = new EncriptarMD5();
    private String usuarioNumero;
    private String usuarioContraseña;

}
