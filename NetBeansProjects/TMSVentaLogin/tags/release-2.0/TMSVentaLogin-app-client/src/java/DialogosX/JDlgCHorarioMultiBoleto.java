/*
 * JIFCHorario.java
 *
 * Created on 6 de septiembre de 2007, 12:41 PM
 */

package DialogosX;

import AsignacionVenta.jDlgAutorizaSupervisor;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Point;
import java.awt.Toolkit;
import java.awt.event.KeyEvent;
import java.util.Date;
import java.util.Vector;
import javax.swing.JComboBox;
import javax.swing.JTable;
import javax.swing.JViewport;
import javax.swing.ListSelectionModel;
import javax.swing.table.TableColumn;
import subProcesos.JClsSintaxis;
import tms_venta.SesionVenta;
import java.text.SimpleDateFormat;
import java.text.ParseException;
import javax.swing.table.DefaultTableModel;
import subProcesos.JTxtFieldAsientos;
import subProcesos.JTxtFieldFolios;
import tms_venta.JClsColoresInterfaz;

/**
 *
 * @author  ocruz
 */
public class JDlgCHorarioMultiBoleto extends javax.swing.JDialog{
    private Vector pOrigenes;

    private String numTarLeal ="";
    private boolean redencionSOC = false;
    
    /** Creates new form JIFCHorario */
    public JDlgCHorarioMultiBoleto(SesionVenta pSesionVenta, Vector pOrigenes, Object[] pObjEmp, Date pThX){
        this.setModal(true);
        this.pOrigenes = pOrigenes;
        this.sesionVenta = pSesionVenta;
        this.objEmp = pObjEmp;
        this.thX = pThX;
        objEmpresas = new Object[objEmp.length];
        for(int i=0; i<objEmpresas.length; i++)
            objEmpresas[i] = sesionVenta.getEmpresasId(objEmp[i].toString()) + "-" + objEmp[i].toString();
        ordenaListaEmpresas();
        initComponents();
        jTblBoletoOriginal.setAutoResizeMode( JTable.AUTO_RESIZE_OFF );
        jLabel4.setText("<html><font color="+ColoresInterfaz.cHTML3+">IZQ DER </font> Ingresar Criterios | <font color="+ColoresInterfaz.cHTML3+">ENTER</font> Buscar Boleto | <font color="+ColoresInterfaz.cHTML3+">ESC</font> Salir</html>");
        interfazColor();
        this.setTitle("Cambiar Horario de Boleto");
        centrarJDialog();
        this.sesionVenta.setNumeroTarjetaSocio("");
        jchbx_bolRef.setFocusTraversalKeysEnabled(false);
        jchbx_bolConv.setFocusTraversalKeysEnabled(false);
        jCboDestino.setVisible(false);
        jLabel3.setVisible(true);
        jTxtNoAsiento.setVisible(true);
        jLabel5.setVisible(true);
        jCboEmpresas.setVisible(true);
        jClsSintaxis = new JClsSintaxis();
        xTabla.setDataVector(null, encabezado);
        AnchoColumnas();
    }
    
    private void centrarJDialog(){
        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
        Dimension frameSize = this.getSize();
        if (frameSize.height > screenSize.height) {
            frameSize.height = screenSize.height;
        }
        if (frameSize.width > screenSize.width) {
            frameSize.width = screenSize.width;
        }
        this.setLocation( ( screenSize.width - frameSize.width ) / 2, ( screenSize.height - frameSize.height ) / 2 );
    }
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jCboOrigen = new javax.swing.JComboBox();
        jCboOrigen = new JComboBox(pOrigenes);
        jCboOrigen.setFocusTraversalKeysEnabled(false);
        jlbl_folRef = new javax.swing.JLabel();
        jTxtFolioPreimpreso = new JTxtFieldFolios();
        jTxtFolioPreimpreso.setFocusTraversalKeysEnabled(false);
        jLabel3 = new javax.swing.JLabel();
        jTxtNoAsiento = new JTxtFieldAsientos();
        jTxtNoAsiento.setFocusTraversalKeysEnabled(false);
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jCboEmpresas = new javax.swing.JComboBox();
        jCboEmpresas = new JComboBox(objEmpresas);
        jScpBoletoOriginal = new javax.swing.JScrollPane();
        jTblBoletoOriginal = new javax.swing.JTable();
        jchbx_bolRef = new javax.swing.JCheckBox();
        jchbx_bolConv = new javax.swing.JCheckBox();
        jCboDestino = new javax.swing.JComboBox();
        jCboDestino = new JComboBox(pOrigenes);
        jCboDestino.setFocusTraversalKeysEnabled(false);

        setDefaultCloseOperation(javax.swing.WindowConstants.DO_NOTHING_ON_CLOSE);
        setName("Ventana");
        setResizable(false);
        addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentShown(java.awt.event.ComponentEvent evt) {
                formComponentShown(evt);
            }
        });

        jPanel1.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 10));
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel1.setText("Origen");

        jCboOrigen.setFont(new java.awt.Font("Tahoma", 1, 10));
        jCboOrigen.setName("Origen");
        jCboOrigen.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jCboOrigenKeyPressed(evt);
            }
        });

        jlbl_folRef.setFont(new java.awt.Font("Tahoma", 1, 10));
        jlbl_folRef.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jlbl_folRef.setText("Folio");

        jTxtFolioPreimpreso.setFont(new java.awt.Font("Tahoma", 1, 10));
        jTxtFolioPreimpreso.setName("FolioPreimpreso");
        jTxtFolioPreimpreso.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jTxtFolioPreimpresoFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                jTxtFolioPreimpresoFocusLost(evt);
            }
        });
        jTxtFolioPreimpreso.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTxtFolioPreimpresoKeyPressed(evt);
            }
        });

        jLabel3.setFont(new java.awt.Font("Tahoma", 1, 10));
        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel3.setText("# Asiento");

        jTxtNoAsiento.setFont(new java.awt.Font("Tahoma", 1, 10));
        jTxtNoAsiento.setName("noAsiento");
        jTxtNoAsiento.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jTxtNoAsientoFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                jTxtNoAsientoFocusLost(evt);
            }
        });
        jTxtNoAsiento.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTxtNoAsientoKeyPressed(evt);
            }
        });

        jLabel4.setFont(new java.awt.Font("Tahoma", 1, 10));
        jLabel4.setText("<html><font color=\"+ColoresInterfaz.cHTML1+\">IZQ DER </font> Ingresar Criterios | <font color=\"+ColoresInterfaz.cHTML1+\">ENTER</font> Buscar Boleto | <font color=\"+ColoresInterfaz.cHTML1+\">ESC</font> Salir</html>");
        jLabel4.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jLabel5.setFont(new java.awt.Font("Tahoma", 1, 10));
        jLabel5.setText("Empresa");

        jCboEmpresas.setFont(new java.awt.Font("Tahoma", 1, 10));
        jCboEmpresas.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jCboEmpresasKeyPressed(evt);
            }
        });

        jScpBoletoOriginal.setFocusable(false);
        jScpBoletoOriginal.setFont(new java.awt.Font("Tahoma", 1, 10));
        jTblBoletoOriginal.setFont(new java.awt.Font("Tahoma", 1, 10));
        jTblBoletoOriginal.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {

            }
        ));
        jTblBoletoOriginal.setModel(xTabla);
        jTblBoletoOriginal.getTableHeader().setReorderingAllowed(false);
        jTblBoletoOriginal.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        jTblBoletoOriginal.setFocusTraversalKeysEnabled(false);
        jTblBoletoOriginal.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jTblBoletoOriginalFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                jTblBoletoOriginalFocusLost(evt);
            }
        });
        jTblBoletoOriginal.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTblBoletoOriginalKeyPressed(evt);
            }
        });

        jScpBoletoOriginal.setViewportView(jTblBoletoOriginal);

        jchbx_bolRef.setFont(new java.awt.Font("Tahoma", 1, 10));
        jchbx_bolRef.setText("Boleto Referenciado");
        jchbx_bolRef.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        jchbx_bolRef.setMargin(new java.awt.Insets(0, 0, 0, 0));
        jchbx_bolRef.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jchbx_bolRefFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                jchbx_bolRefFocusLost(evt);
            }
        });
        jchbx_bolRef.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jchbx_bolRefKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jchbx_bolRefKeyReleased(evt);
            }
        });
        jchbx_bolRef.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jchbx_bolRefMouseClicked(evt);
            }
        });

        jchbx_bolConv.setFont(new java.awt.Font("Tahoma", 1, 11));
        jchbx_bolConv.setText("Boleto Convenio");
        jchbx_bolConv.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        jchbx_bolConv.setMargin(new java.awt.Insets(0, 0, 0, 0));
        jchbx_bolConv.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jchbx_bolConvFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                jchbx_bolConvFocusLost(evt);
            }
        });
        jchbx_bolConv.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jchbx_bolConvKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jchbx_bolConvKeyReleased(evt);
            }
        });
        jchbx_bolConv.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jchbx_bolConvMouseClicked(evt);
            }
        });

        jCboDestino.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jCboDestinoKeyPressed(evt);
            }
        });

        org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jLabel4, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 951, Short.MAX_VALUE)
            .add(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jScpBoletoOriginal, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 931, Short.MAX_VALUE)
                    .add(jPanel1Layout.createSequentialGroup()
                        .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                            .add(jLabel5)
                            .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                                .add(org.jdesktop.layout.GroupLayout.LEADING, jlbl_folRef, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 49, Short.MAX_VALUE)
                                .add(org.jdesktop.layout.GroupLayout.LEADING, jLabel3, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .add(org.jdesktop.layout.GroupLayout.LEADING, jLabel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(jPanel1Layout.createSequentialGroup()
                                .add(jCboOrigen, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 110, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .add(34, 34, 34)
                                .add(jchbx_bolRef)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jchbx_bolConv)
                                .add(22, 22, 22)
                                .add(jCboDestino, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 126, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                            .add(jCboEmpresas, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 290, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                            .add(jTxtFolioPreimpreso, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 878, Short.MAX_VALUE)
                            .add(jTxtNoAsiento, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 878, Short.MAX_VALUE))))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel1)
                    .add(jCboOrigen, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 21, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jchbx_bolRef)
                    .add(jCboDestino, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jchbx_bolConv))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jlbl_folRef)
                    .add(jTxtFolioPreimpreso, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 21, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel3)
                    .add(jTxtNoAsiento, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 21, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jCboEmpresas, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jLabel5))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jScpBoletoOriginal, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 237, Short.MAX_VALUE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jLabel4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 17, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
        );

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jCboDestinoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jCboDestinoKeyPressed
 switch(evt.getKeyCode()){
            case KeyEvent.VK_ESCAPE:
                chOk=false;
                this.dispose();
                break;
            case KeyEvent.VK_ENTER:
                    if(!validaCampos()) return;
                    if(!valMultiTx(jTxtFolioPreimpreso.getText(), jTxtNoAsiento.getText())) return;
                    ConstruyeMultiHo();
                    if(jCboOrigen.getSelectedItem().toString().equals(sesionVenta.getUserCon().getTerminalNombre())) sesionVenta.setTipoTransaccion("L");
                    else sesionVenta.setTipoTransaccion("R");
                    boletos = sesionVenta.buscaBoletoVendidoParaHOMult(jCboOrigen.getSelectedItem().toString(), 
                            conjuntoFolios, conjuntoAsientos, 
                            jCboEmpresas.getSelectedItem().toString().substring(2),
                            jClsSintaxis.getVectorFoliosBoletos().size(),jCboDestino.getSelectedItem().toString(),jchbx_bolConv.isSelected());
                    if(boletos==null){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","No es posible cambiar de horario este boleto.", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(!sonBoletosIgualCorrida()){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Todos los boletos deben pertenecer<br>a la misma corrida.</html>", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(sesionVenta.getDtFechaDespachoTarjeta()!=null){
                        Date fechaActual = thX;
                        long minutosDespues = sesionVenta.getUserCon().getMinDesCan()*60000;
                        Date fechaCalculada = new Date(sesionVenta.getDtFechaDespachoTarjeta().getTime()+minutosDespues);
                        System.out.println(sesionVenta.getDtFechaDespachoTarjeta().getTime()+" --- "+sesionVenta.getDtFechaDespachoTarjeta());
                        System.out.println(fechaCalculada.getTime()+" --- "+fechaCalculada);
                        System.out.println(fechaActual.getTime()+" --- "+fechaActual);
                        if(fechaActual.getTime()>fechaCalculada.getTime()){
                            DialogoAceptar.mostrarDialogo("¡Tiempo para cambio de horario agotado!","Pida autorizacion del Supervisor.", Color.RED);
                            jDlgAutorizaSupervisor dlg = new jDlgAutorizaSupervisor(sesionVenta,"5006", "Cambiar Horario Boleto");
                            dlg.setVisible(true);
                            if(!dlg.getRespuesta()) return;
                        }
                    }
                    
                    sesionVenta.setTipoTransaccionAuxiliar(sesionVenta.getTipoTransaccion());
                    sesionVenta.setDBLinkAuxiliar(sesionVenta.getDBLink());
                    String FHc = sesionVenta.FechaHoraCorrida();
                    String conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {
                        //System.out.println("FECHA CORRIDA "+FHc);
                        if(FHc==null){
                            DialogoAceptar.mostrarDialogo("¡Corrida sin fecha asociada!","Contacte al administrador del sistema.", Color.RED);
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();
                            return;
                        }
                    }                    
                    // MOD: PARA VARIOS
                    String tipoPasajeACanjear="";
                    for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
                        tipoPasajeACanjear = sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPasajero();
                        if(tipoPasajeACanjear.equals("E") || tipoPasajeACanjear.equals("P")){
                            if(!sesionVenta.sonVacaciones()){
                                DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Tipo de pasajero "+tipoPasajeACanjear+" solo esta habilitado<br>en periodo vacacional.</html>", Color.RED);
                                chOk=false;
                                this.dispose();
                                return;
                            }
                        }
                    }
                    
                    importeBolOriginalAdulto = sesionVenta.getTmsBoletosVentaTbl().getImporteBoleto();
                    tipoPasajero = sesionVenta.getTmsBoletosVentaTbl().getTipoPasajero();
                    ServicioCH = sesionVenta.getTmsBoletosVentaTbl().getServicio();
                    CiudadCorridaCH = jCboOrigen.getSelectedItem().toString();
                    EmpresaCH = sesionVenta.getTmsBoletosVentaTbl().getEmpresa();
                    chOk=true;
                     conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {

                        for(int i=0; i<boletos.length; i++){
                            try {
                                boletos[i][1] = formatoFechaHora.format(formatoDateServer2.parse(FHc).getTime());
                            } catch (ParseException ex) {
                                DialogoAceptar.mostrarDialogo("¡Corrida con fecha invalida!","Contacte al administrador del sistema.", Color.RED);
                                jTxtFolioPreimpreso.setText("");
                                jTxtNoAsiento.setText("");
                                jCboEmpresas.setSelectedIndex(0);
                                jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();

                                return;
                            }
                        }
                    }
                    verificarEstrellas();                    
                    xTabla.setDataVector(boletos, encabezado);
                    AnchoColumnas();
                    jTblBoletoOriginal.setRowSelectionInterval(0,0);
                    jTblBoletoOriginal.requestFocusInWindow();
                break;
            
            case KeyEvent.VK_LEFT:
                    jchbx_bolConv.requestFocusInWindow();
                break;
            case KeyEvent.VK_RIGHT:
                    jTxtFolioPreimpreso.selectAll();
                    jTxtFolioPreimpreso.requestFocusInWindow();
                break;
        }
    }//GEN-LAST:event_jCboDestinoKeyPressed

    private void jchbx_bolConvMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jchbx_bolConvMouseClicked
          if(jchbx_bolConv.isSelected())
          {
              jchbx_bolConv.setSelected(false);
              jCboDestino.setVisible(false);
                jLabel3.setVisible(true);
                jTxtNoAsiento.setVisible(true);
                jLabel5.setVisible(true);
                jCboEmpresas.setVisible(true);

          }
          else
          {
             jchbx_bolConv.setSelected(true);   
             jCboDestino.setVisible(true);
            jLabel3.setVisible(false);
            jTxtNoAsiento.setVisible(false);
            jLabel5.setVisible(false);
            jCboEmpresas.setVisible(false);
            jCboDestino.setSelectedIndex(0);
          }
    }//GEN-LAST:event_jchbx_bolConvMouseClicked

    private void jchbx_bolConvKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jchbx_bolConvKeyPressed
     if(evt.getKeyCode() == evt.VK_SPACE)
        ;//return;
        
     if(evt.getKeyCode() == evt.VK_LEFT)
             jchbx_bolRef.requestFocus();
         
     if(evt.getKeyCode() == evt.VK_RIGHT)    
     {
         if(jCboDestino.isVisible())
             jCboDestino.requestFocusInWindow();
         else
         {
             jTxtFolioPreimpreso.selectAll();
             jTxtFolioPreimpreso.requestFocusInWindow();
         }
     }
     
     if(evt.getKeyCode() == evt.VK_F2)
     {
         if(jchbx_bolConv.isSelected())
         {
             jchbx_bolConv.setSelected(false);
             jCboDestino.setVisible(false);
            jLabel3.setVisible(true);
            jTxtNoAsiento.setVisible(true);
            jLabel5.setVisible(true);
            jCboEmpresas.setVisible(true);
         }
         else
         {
             jchbx_bolConv.setSelected(true);
             jCboDestino.setVisible(true);
            jLabel3.setVisible(false);
            jTxtNoAsiento.setVisible(false);
            jLabel5.setVisible(false);
            jCboEmpresas.setVisible(false);
             jCboDestino.setSelectedIndex(0);
         }
     }
     
            if(evt.getKeyCode() == evt.VK_ESCAPE)
            {
                chOk=false;
                this.dispose();
            }


        if(evt.getKeyCode() == evt.VK_ENTER)
          {
                    if(!validaCampos()) return;
                    if(!valMultiTx(jTxtFolioPreimpreso.getText(), jTxtNoAsiento.getText())) return;
                    ConstruyeMultiHo();
                    if(jCboOrigen.getSelectedItem().toString().equals(sesionVenta.getUserCon().getTerminalNombre())) sesionVenta.setTipoTransaccion("L");
                    else sesionVenta.setTipoTransaccion("R");
                    boletos = sesionVenta.buscaBoletoVendidoParaHOMult(jCboOrigen.getSelectedItem().toString(), 
                            conjuntoFolios, conjuntoAsientos, 
                            jCboEmpresas.getSelectedItem().toString().substring(2),
                            jClsSintaxis.getVectorFoliosBoletos().size(),jCboDestino.getSelectedItem().toString(),jchbx_bolConv.isSelected());
                    if(boletos==null){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","No es posible cambiar de horario este boleto.", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(!sonBoletosIgualCorrida()){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Todos los boletos deben pertenecer<br>a la misma corrida.</html>", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(sesionVenta.getDtFechaDespachoTarjeta()!=null){
                        Date fechaActual = thX;
                        long minutosDespues = sesionVenta.getUserCon().getMinDesCan()*60000;
                        Date fechaCalculada = new Date(sesionVenta.getDtFechaDespachoTarjeta().getTime()+minutosDespues);
                        System.out.println(sesionVenta.getDtFechaDespachoTarjeta().getTime()+" --- "+sesionVenta.getDtFechaDespachoTarjeta());
                        System.out.println(fechaCalculada.getTime()+" --- "+fechaCalculada);
                        System.out.println(fechaActual.getTime()+" --- "+fechaActual);
                        if(fechaActual.getTime()>fechaCalculada.getTime()){
                            DialogoAceptar.mostrarDialogo("¡Tiempo para cambio de horario agotado!","Pida autorizacion del Supervisor.", Color.RED);
                            jDlgAutorizaSupervisor dlg = new jDlgAutorizaSupervisor(sesionVenta,"5006", "Cambiar Horario Boleto");
                            dlg.setVisible(true);
                            if(!dlg.getRespuesta()) return;
                        }
                    }
                    sesionVenta.setTipoTransaccionAuxiliar(sesionVenta.getTipoTransaccion());
                    sesionVenta.setDBLinkAuxiliar(sesionVenta.getDBLink());
                    String FHc = sesionVenta.FechaHoraCorrida();
                    String conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {
                        //System.out.println("FECHA CORRIDA "+FHc);
                        if(FHc==null){
                            DialogoAceptar.mostrarDialogo("¡Corrida sin fecha asociada!","Contacte al administrador del sistema.", Color.RED);
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();
                            return;
                        }
                    }
                    // MOD: PARA VARIOS
                    String tipoPasajeACanjear="";
                    for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
                        tipoPasajeACanjear = sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPasajero();
                        if(tipoPasajeACanjear.equals("E") || tipoPasajeACanjear.equals("P")){
                            if(!sesionVenta.sonVacaciones()){
                                DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Tipo de pasajero "+tipoPasajeACanjear+" solo esta habilitado<br>en periodo vacacional.</html>", Color.RED);
                                chOk=false;
                                this.dispose();
                                return;
                            }
                        }
                    }
                    
                    importeBolOriginalAdulto = sesionVenta.getTmsBoletosVentaTbl().getImporteBoleto();
                    tipoPasajero = sesionVenta.getTmsBoletosVentaTbl().getTipoPasajero();
                    ServicioCH = sesionVenta.getTmsBoletosVentaTbl().getServicio();
                    CiudadCorridaCH = jCboOrigen.getSelectedItem().toString();
                    EmpresaCH = sesionVenta.getTmsBoletosVentaTbl().getEmpresa();
                    chOk=true;
                     conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {

                        for(int i=0; i<boletos.length; i++){
                            try {
                                boletos[i][1] = formatoFechaHora.format(formatoDateServer2.parse(FHc).getTime());
                            } catch (ParseException ex) {
                                DialogoAceptar.mostrarDialogo("¡Corrida con fecha invalida!","Contacte al administrador del sistema.", Color.RED);
                                jTxtFolioPreimpreso.setText("");
                                jTxtNoAsiento.setText("");
                                jCboEmpresas.setSelectedIndex(0);
                                jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();

                                return;
                            }
                        }
                    }
                    verificarEstrellas();
                    xTabla.setDataVector(boletos, encabezado);
                    AnchoColumnas();
                    jTblBoletoOriginal.setRowSelectionInterval(0,0);
                    jTblBoletoOriginal.requestFocusInWindow();
        }
    }//GEN-LAST:event_jchbx_bolConvKeyPressed

    private void jchbx_bolConvKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jchbx_bolConvKeyReleased
      if(evt.getKeyCode() == evt.VK_SPACE)
      {
          jchbx_bolConv.setSelected(!jchbx_bolConv.isSelected());
          /*
          if(jchbx_bolConv.isSelected())
          {
              jchbx_bolConv.setSelected(false);
              jCboDestino.setVisible(false);
          }
          else
          {
              jchbx_bolConv.setSelected(true);
              jCboDestino.setVisible(true);
              jCboDestino.setSelectedIndex(0);
          }
           *
           */
      }
// TODO add your handling code here:
    }//GEN-LAST:event_jchbx_bolConvKeyReleased

    private void jchbx_bolConvFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jchbx_bolConvFocusLost
        jchbx_bolConv.setFont(new java.awt.Font("Tahoma", 1, 10));
        jLabel4.setText("<html><font color="+ColoresInterfaz.cHTML3+">IZQ DER </font> Ingresar Criterios | <font color="+ColoresInterfaz.cHTML3+">ENTER</font> Buscar Boleto | <font color="+ColoresInterfaz.cHTML3+">ESC</font> Salir</html>");

    }//GEN-LAST:event_jchbx_bolConvFocusLost

    private void jchbx_bolConvFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jchbx_bolConvFocusGained
        jchbx_bolConv.setFont(new java.awt.Font("Tahoma", 3, 10));
        jLabel4.setText("<html><font color="+ColoresInterfaz.cHTML3+">IZQ DER </font> Ingresar Criterios | <font color="+ColoresInterfaz.cHTML3+">F2</font> Seleccionar/Deseleccionar | <font color="+ColoresInterfaz.cHTML3+">ENTER</font> Buscar Boleto | <font color="+ColoresInterfaz.cHTML3+">ESC</font> Salir</html>");

    }//GEN-LAST:event_jchbx_bolConvFocusGained

    private void jchbx_bolRefMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jchbx_bolRefMouseClicked
          if(jchbx_bolRef.isSelected())
              jchbx_bolRef.setSelected(false);
          else
             jchbx_bolRef.setSelected(true);   
    }//GEN-LAST:event_jchbx_bolRefMouseClicked

    private void jchbx_bolRefKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jchbx_bolRefKeyReleased
      if(evt.getKeyCode() == evt.VK_SPACE)
      {
          if(jchbx_bolRef.isSelected())
              jchbx_bolRef.setSelected(false);
          else
             jchbx_bolRef.setSelected(true);     
      }

    }//GEN-LAST:event_jchbx_bolRefKeyReleased

    private void jchbx_bolRefFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jchbx_bolRefFocusLost
        jchbx_bolRef.setFont(new java.awt.Font("Tahoma", 1, 10));
        jLabel4.setText("<html><font color="+ColoresInterfaz.cHTML3+">IZQ DER </font> Ingresar Criterios | <font color="+ColoresInterfaz.cHTML3+">ENTER</font> Buscar Boleto | <font color="+ColoresInterfaz.cHTML3+">ESC</font> Salir</html>");
    }//GEN-LAST:event_jchbx_bolRefFocusLost

    private void jchbx_bolRefFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jchbx_bolRefFocusGained
        jchbx_bolRef.setFont(new java.awt.Font("Tahoma", 3, 10));
        jLabel4.setText("<html><font color="+ColoresInterfaz.cHTML3+">IZQ DER </font> Ingresar Criterios | <font color="+ColoresInterfaz.cHTML3+">F2</font> Seleccionar/Deseleccionar | <font color="+ColoresInterfaz.cHTML3+">ENTER</font> Buscar Boleto | <font color="+ColoresInterfaz.cHTML3+">ESC</font> Salir</html>");
    }//GEN-LAST:event_jchbx_bolRefFocusGained

    private void jchbx_bolRefKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jchbx_bolRefKeyPressed
     if(evt.getKeyCode() == evt.VK_SPACE)
        return;
        
     if(evt.getKeyCode() == evt.VK_LEFT)
      if(jCboOrigen.isEnabled())
          jCboOrigen.requestFocus();
         
     if(evt.getKeyCode() == evt.VK_RIGHT)    
         jchbx_bolConv.requestFocusInWindow();
     
     if(evt.getKeyCode() == evt.VK_F2)
     {
         if(jchbx_bolRef.isSelected())
         {
             jchbx_bolRef.setSelected(false);
             jlbl_folRef.setText("Folio");
             jCboOrigen.setEnabled(true);
             jCboEmpresas.setEnabled(true);
             jTxtNoAsiento.setText("");
             jTxtNoAsiento.setEnabled(true);      
             
         }
         else
         {
             jchbx_bolRef.setSelected(true);
             jlbl_folRef.setText("Referencia");
             jCboOrigen.setEnabled(false);
             jCboEmpresas.setEnabled(false);
             jTxtNoAsiento.setText("");
             jTxtNoAsiento.setEnabled(false);
         }
     }
     
            if(evt.getKeyCode() == evt.VK_ESCAPE)
            {
                chOk=false;
                this.dispose();
            }


        if(evt.getKeyCode() == evt.VK_ENTER)
          {
                    if(!validaCampos()) return;
                    if(!valMultiTx(jTxtFolioPreimpreso.getText(), jTxtNoAsiento.getText())) return;
                    ConstruyeMultiHo();
                    if(jCboOrigen.getSelectedItem().toString().equals(sesionVenta.getUserCon().getTerminalNombre())) sesionVenta.setTipoTransaccion("L");
                    else sesionVenta.setTipoTransaccion("R");
                    boletos = sesionVenta.buscaBoletoVendidoParaHOMult(jCboOrigen.getSelectedItem().toString(), 
                            conjuntoFolios, conjuntoAsientos, 
                            jCboEmpresas.getSelectedItem().toString().substring(2),
                            jClsSintaxis.getVectorFoliosBoletos().size(),jCboDestino.getSelectedItem().toString(),jchbx_bolConv.isSelected());
                    if(boletos==null){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","No es posible cambiar de horario este boleto.", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(!sonBoletosIgualCorrida()){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Todos los boletos deben pertenecer<br>a la misma corrida.</html>", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(sesionVenta.getDtFechaDespachoTarjeta()!=null){
                        Date fechaActual = thX;
                        long minutosDespues = sesionVenta.getUserCon().getMinDesCan()*60000;
                        Date fechaCalculada = new Date(sesionVenta.getDtFechaDespachoTarjeta().getTime()+minutosDespues);
                        System.out.println(sesionVenta.getDtFechaDespachoTarjeta().getTime()+" --- "+sesionVenta.getDtFechaDespachoTarjeta());
                        System.out.println(fechaCalculada.getTime()+" --- "+fechaCalculada);
                        System.out.println(fechaActual.getTime()+" --- "+fechaActual);
                        if(fechaActual.getTime()>fechaCalculada.getTime()){
                            DialogoAceptar.mostrarDialogo("¡Tiempo para cambio de horario agotado!","Pida autorizacion del Supervisor.", Color.RED);
                            jDlgAutorizaSupervisor dlg = new jDlgAutorizaSupervisor(sesionVenta,"5006", "Cambiar Horario Boleto");
                            dlg.setVisible(true);
                            if(!dlg.getRespuesta()) return;
                        }
                    }
                    sesionVenta.setTipoTransaccionAuxiliar(sesionVenta.getTipoTransaccion());
                    sesionVenta.setDBLinkAuxiliar(sesionVenta.getDBLink());
                    String FHc = sesionVenta.FechaHoraCorrida();
                    String conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {
                        //System.out.println("FECHA CORRIDA "+FHc);
                        if(FHc==null){
                            DialogoAceptar.mostrarDialogo("¡Corrida sin fecha asociada!","Contacte al administrador del sistema.", Color.RED);
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();
                            return;
                        }
                    }
                    // MOD: PARA VARIOS
                    String tipoPasajeACanjear="";
                    for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
                        tipoPasajeACanjear = sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPasajero();
                        if(tipoPasajeACanjear.equals("E") || tipoPasajeACanjear.equals("P")){
                            if(!sesionVenta.sonVacaciones()){
                                DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Tipo de pasajero "+tipoPasajeACanjear+" solo esta habilitado<br>en periodo vacacional.</html>", Color.RED);
                                chOk=false;
                                this.dispose();
                                return;
                            }
                        }
                    }
                    
                    importeBolOriginalAdulto = sesionVenta.getTmsBoletosVentaTbl().getImporteBoleto();
                    tipoPasajero = sesionVenta.getTmsBoletosVentaTbl().getTipoPasajero();
                    ServicioCH = sesionVenta.getTmsBoletosVentaTbl().getServicio();
                    CiudadCorridaCH = jCboOrigen.getSelectedItem().toString();
                    EmpresaCH = sesionVenta.getTmsBoletosVentaTbl().getEmpresa();
                    chOk=true;
                     conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {

                        for(int i=0; i<boletos.length; i++){
                            try {
                                boletos[i][1] = formatoFechaHora.format(formatoDateServer2.parse(FHc).getTime());
                            } catch (ParseException ex) {
                                DialogoAceptar.mostrarDialogo("¡Corrida con fecha invalida!","Contacte al administrador del sistema.", Color.RED);
                                jTxtFolioPreimpreso.setText("");
                                jTxtNoAsiento.setText("");
                                jCboEmpresas.setSelectedIndex(0);
                                jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();

                                return;
                            }
                        }
                    }
                    verificarEstrellas();
                    xTabla.setDataVector(boletos, encabezado);
                    AnchoColumnas();
                    jTblBoletoOriginal.setRowSelectionInterval(0,0);
                    jTblBoletoOriginal.requestFocusInWindow();
        }
    
//          if(evt.getKeyCode() == evt.VK_ENTER)
//          {
//                    if(!this.COAnt.equals(jCboOrigen.getSelectedItem().toString())){
//                        sesionVenta.getDBLinkClaveOrigen(jCboOrigen.getSelectedItem().toString());
//                        sesionVenta.cargarODServicios(jCboOrigen.getSelectedItem().toString());
//                        cbmServicio = new DefaultComboBoxModel(sesionVenta.getSs());
//                        jCboServicio.setModel(cbmServicio);
//                        this.COAnt=jCboOrigen.getSelectedItem().toString();
//                    }
//                    if(!validaCampos()) return;
//                    if(!valMultiTx(jTxtFolioPreimpreso.getText())) return;
//                    ConstruyeMultiBa();
//                    if(jCboOrigen.getSelectedItem().toString().equals(sesionVenta.getUserCon().getTerminalNombre())) sesionVenta.setTipoTransaccion("L");
//                    else sesionVenta.setTipoTransaccion("R");
//                    boletos = sesionVenta.buscaBoletoAbiertoMult(jCboOrigen.getSelectedItem().toString(), conjuntoFolios, 
//                            sesionVenta.getVectorServiciosReal(jCboServicio.getSelectedItem().toString()), jCboEmpresas.getSelectedItem().toString().substring(2),
//                            jClsSintaxis.getVectorFoliosBoletos().size());
//                    if(boletos==null){
//                        DialogoAceptar.mostrarDialogo("¡Imposible realizar canje!","<html>Puede ser que los criterios de busqueda son incorrectos o<br>" +
//                                "el boleto no es abierto o ya fue canjeado o<br>la vigencia de canje ya caduco.</html>", Color.RED);
//                        jTxtFolioPreimpreso.setText("");
//                        jCboEmpresas.setSelectedIndex(0);
//                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
//                        if(!this.COAnt.equals(jCboOrigen.getSelectedItem().toString())){
//                            sesionVenta.getDBLinkClaveOrigen(jCboOrigen.getSelectedItem().toString());
//                            sesionVenta.cargarODServicios(jCboOrigen.getSelectedItem().toString());
//                            cbmServicio = new DefaultComboBoxModel(sesionVenta.getSs());
//                            jCboServicio.setModel(cbmServicio);
//                            this.COAnt=jCboOrigen.getSelectedItem().toString();
//                        }
//                        jCboOrigen.requestFocusInWindow();
//                        return;
//                    }
//                    
//                    if(!sonBoletosIgualCorrida()){
//                        DialogoAceptar.mostrarDialogo("Canje de boleto abierto.","<html>Todos los boletos deben ser del mismo<br>origen, destino y servicio.</html>", Color.RED);
//                        jTxtFolioPreimpreso.setText("");
//                        jCboServicio.setSelectedIndex(0);
//                        jCboEmpresas.setSelectedIndex(0);
//                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
//                        jCboOrigen.requestFocusInWindow();
//                        return;
//                    }
//                    
//                    sesionVenta.setTipoTransaccionAuxiliar(sesionVenta.getTipoTransaccion());
//                    sesionVenta.setDBLinkAuxiliar(sesionVenta.getDBLink());
//                    
//                    String tipoPasajeACanjear="";
//                    for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
//                        tipoPasajeACanjear = sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPasajero();
//                        if(tipoPasajeACanjear.equals("E") || tipoPasajeACanjear.equals("P")){
//                            if(!sesionVenta.sonVacaciones()){
//                                DialogoAceptar.mostrarDialogo("Canje de boleto abierto.","<html>Tipo de pasajero "+tipoPasajeACanjear+" solo esta habilitado<br>en periodo vacacional.</html>", Color.RED);
//                                chOk=false;
//                                this.dispose();
//                                return;
//                            }
//                        }
//                    }
//                    
//                    importeBolOriginalAdulto = sesionVenta.getTmsBoletosVentaTbl().getImporteBoleto();
//                    EmpresaCBA = sesionVenta.getTmsBoletosVentaTbl().getEmpresa();
//                    ServicioCBA = sesionVenta.getTmsBoletosVentaTbl().getServicio();
//                    OrigenCBA = sesionVenta.getTmsBoletosVentaTbl().getOrigen();
//                    DestinoCBA = sesionVenta.getTmsBoletosVentaTbl().getDestino();
//                    CiudadCorridaCBA = (sesionVenta.ConexionRealBAX(OrigenCBA, DestinoCBA, ServicioCBA)!=null ? OrigenCBA : jCboOrigen.getSelectedItem().toString());
//                    //CiudadCorridaCBA = (existeOrigenComoCiudadConexion(jCboOrigen.getSelectedItem().toString()) ? OrigenCBA : jCboOrigen.getSelectedItem().toString());
//                    
//                    if(!existenCorridasDeEmpresaParaCanjear()){
//                        chOk=false;
//                        this.dispose();
//                        return;
//                    }
//                    
//                    chOk=true;
//
//                    xTabla.setDataVector(boletos, encabezado);
//                    AnchoColumnas();
//                    jTblBoletoOriginal.setRowSelectionInterval(0,0);
//                    jTblBoletoOriginal.requestFocusInWindow();     
//          }

    }//GEN-LAST:event_jchbx_bolRefKeyPressed

    private void jTxtNoAsientoFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtNoAsientoFocusLost
// TODO add your handling code here:
        jTxtNoAsiento.setBackground(Color.WHITE);
    }//GEN-LAST:event_jTxtNoAsientoFocusLost

    private void jTxtNoAsientoFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtNoAsientoFocusGained
// TODO add your handling code here:
        jTxtNoAsiento.setBackground(xorColorFondo);
    }//GEN-LAST:event_jTxtNoAsientoFocusGained

    private void jTxtFolioPreimpresoFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtFolioPreimpresoFocusLost
// TODO add your handling code here:
        jTxtFolioPreimpreso.setBackground(Color.WHITE);
    }//GEN-LAST:event_jTxtFolioPreimpresoFocusLost

    private void jTxtFolioPreimpresoFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtFolioPreimpresoFocusGained
// TODO add your handling code here:
        jTxtFolioPreimpreso.setBackground(xorColorFondo);
    }//GEN-LAST:event_jTxtFolioPreimpresoFocusGained

    private void jTblBoletoOriginalKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTblBoletoOriginalKeyPressed
// TODO add your handling code here:
        switch(evt.getKeyCode()){
            case KeyEvent.VK_ESCAPE: 
                xTabla.setDataVector(null, encabezado);
                AnchoColumnas();
                jLabel4.setText("<html><font color="+ColoresInterfaz.cHTML3+">IZQ DER </font> Ingresar Criterios | <font color="+ColoresInterfaz.cHTML3+">ENTER</font> Buscar Boleto | <font color="+ColoresInterfaz.cHTML3+">ESC</font> Salir</html>");
                if(jchbx_bolRef.isSelected())
                {
                 jTxtFolioPreimpreso.selectAll();
                 jTxtFolioPreimpreso.requestFocusInWindow();
                }
                else
                {
                    jTxtFolioPreimpreso.setText("");
                    jTxtNoAsiento.setText("");
                    jCboEmpresas.setSelectedIndex(0);
                    jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                    jCboOrigen.requestFocusInWindow();
                }
                break;
            case KeyEvent.VK_F2:
                   if(jchbx_bolRef.isSelected())
                    {
                        if(jTblBoletoOriginal.getValueAt(jTblBoletoOriginal.getSelectedRow(),9).toString().equals("N"))
                        {
                            jTblBoletoOriginal.setValueAt("S",jTblBoletoOriginal.getSelectedRow(),9);
                            jTblBoletoOriginal.setColumnSelectionInterval(10,10);
//                            jTblBoletoOriginal.editCellAt(jTblBoletoOriginal.getSelectedRow(),10);
//                            JViewport jv = jScpBoletoOriginal.getViewport();
//                            jv.setViewPosition(new Point(1100,jTblBoletoOriginal.getRowHeight() * jTblBoletoOriginal.getSelectedRow()));
//                            jScpBoletoOriginal.setViewport(jv);
//                            jScpBoletoOriginal.setViewportView(jTblBoletoOriginal);
//                            jv.repaint();
//                            jTblBoletoOriginal.repaint();

                        }
                        else
                        {
                            jTblBoletoOriginal.setValueAt("",jTblBoletoOriginal.getSelectedRow(),10);
                            jTblBoletoOriginal.setColumnSelectionInterval(9,9);
                            jTblBoletoOriginal.editCellAt(9,9);
                            jTblBoletoOriginal.setValueAt("N",jTblBoletoOriginal.getSelectedRow(),9);
                        }
                    }
                break;                
            case KeyEvent.VK_F12:
                if(jchbx_bolRef.isSelected())
                {
                    Vector nb = new Vector();
                    int ncanj = 0;
                    for(int i=0; i<jTblBoletoOriginal.getRowCount();i++)
                    {
                        if(jTblBoletoOriginal.getValueAt(i,9).toString().equals("S") )
                            ncanj++;
                    }
                    if(ncanj==0)
                    {
                        DialogoAceptar.mostrarDialogo("¡Imposible realizar canje!","<html>¡Debes seleccionar almenos un boleto para cambiar de horario!</html>", Color.RED);
                        return;
                    }
                    
                    if(!sonBoletosReferenIgualCorrid()){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Todos los boletos deben pertenecer<br>a la misma corrida.</html>", Color.RED);
                        return;
                    }

                    for(int i=0; i<jTblBoletoOriginal.getRowCount();i++)
                        sesionVenta.getVariosTmsBoletosVentaTbl().get(i).setDocumento(jTblBoletoOriginal.getValueAt(i,10).toString());
                    for(int i=0; i<jTblBoletoOriginal.getRowCount();i++)
                        if(jTblBoletoOriginal.getValueAt(i,9).toString().equals("N"))
                            nb.add(i);
                    System.out.println("Eliminar: "+nb);
                    for(int i=0; i<nb.size(); i++) 
                        sesionVenta.getVariosTmsBoletosVentaTbl().remove(Integer.valueOf(nb.get(i).toString())-i);
                    
                    Object[][] boletos2 = new Object[boletos.length - nb.size()][14];
                    int n =0;
                    for(int i=0; i<boletos.length; i++) 
                    {
                        //sesionVenta.getVariosTmsBoletosVentaTbl().remove(Integer.valueOf(nb.get(i).toString())-i);
                        if(nb.indexOf(i)==-1)
                        {
                            for(int j =0; j<14; j++)
                                boletos2[n][j] = boletos[i][j];
                            n++;
                        }
                        
                    }
                    boletos = null;
                    boletos = boletos2;
                }
                this.dispose();
                break;
        }
    }//GEN-LAST:event_jTblBoletoOriginalKeyPressed

    private void jTblBoletoOriginalFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTblBoletoOriginalFocusLost
// TODO add your handling code here:
    }//GEN-LAST:event_jTblBoletoOriginalFocusLost

    private void jTblBoletoOriginalFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTblBoletoOriginalFocusGained
// TODO add your handling code here:
        if(jchbx_bolRef.isSelected())
            jLabel4.setText("<html><font color="+ColoresInterfaz.cHTML3+">F2</font> Seleccionar boleto para cambio de horario | <font color="+ColoresInterfaz.cHTML3+">F12</font> Realizar Cambio de Horario | <font color="+ColoresInterfaz.cHTML3+">ESC</font> Nueva Busqueda</html>");
        else
            jLabel4.setText("<html><font color="+ColoresInterfaz.cHTML3+">F12</font> Realizar Cambio de Horario | <font color="+ColoresInterfaz.cHTML3+">ESC</font> Nueva Busqueda</html>");
    }//GEN-LAST:event_jTblBoletoOriginalFocusGained

    private void jCboEmpresasKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jCboEmpresasKeyPressed
// TODO add your handling code here:
        switch(evt.getKeyCode()){
            case KeyEvent.VK_ESCAPE:
                chOk=false;
                this.dispose();
                break;
            case KeyEvent.VK_ENTER:
                    if(!validaCampos()) return;
                    if(!valMultiTx(jTxtFolioPreimpreso.getText(), jTxtNoAsiento.getText())) return;
                    ConstruyeMultiHo();
                    if(jCboOrigen.getSelectedItem().toString().equals(sesionVenta.getUserCon().getTerminalNombre())) sesionVenta.setTipoTransaccion("L");
                    else sesionVenta.setTipoTransaccion("R");
                    boletos = sesionVenta.buscaBoletoVendidoParaHOMult(jCboOrigen.getSelectedItem().toString(), 
                            conjuntoFolios, conjuntoAsientos, 
                            jCboEmpresas.getSelectedItem().toString().substring(2),
                            jClsSintaxis.getVectorFoliosBoletos().size(),jCboDestino.getSelectedItem().toString(),jchbx_bolConv.isSelected());
                    if(boletos==null){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","No es posible cambiar de horario este boleto.", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(!sonBoletosIgualCorrida()){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Todos los boletos deben pertenecer<br>a la misma corrida.</html>", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(sesionVenta.getDtFechaDespachoTarjeta()!=null){
                        Date fechaActual = thX;
                        long minutosDespues = sesionVenta.getUserCon().getMinDesCan()*60000;
                        Date fechaCalculada = new Date(sesionVenta.getDtFechaDespachoTarjeta().getTime()+minutosDespues);
                        System.out.println(sesionVenta.getDtFechaDespachoTarjeta().getTime()+" --- "+sesionVenta.getDtFechaDespachoTarjeta());
                        System.out.println(fechaCalculada.getTime()+" --- "+fechaCalculada);
                        System.out.println(fechaActual.getTime()+" --- "+fechaActual);
                        if((fechaActual.getTime()>fechaCalculada.getTime())){
                            DialogoAceptar.mostrarDialogo("¡Tiempo para cambio de horario agotado!","Pida autorizacion del Supervisor.", Color.RED);
                            jDlgAutorizaSupervisor dlg = new jDlgAutorizaSupervisor(sesionVenta,"5006", "Cambiar Horario Boleto");
                            dlg.setVisible(true);
                            if(!dlg.getRespuesta()) return;
                        }
                    }
                    
                    sesionVenta.setTipoTransaccionAuxiliar(sesionVenta.getTipoTransaccion());
                    sesionVenta.setDBLinkAuxiliar(sesionVenta.getDBLink());
                    String FHc = sesionVenta.FechaHoraCorrida();
                    String conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {
                        //System.out.println("FECHA CORRIDA "+FHc);
                        if(FHc==null){
                            DialogoAceptar.mostrarDialogo("¡Corrida sin fecha asociada!","Contacte al administrador del sistema.", Color.RED);
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();
                            return;
                        }
                    }                    
                    // MOD: PARA VARIOS
                    String tipoPasajeACanjear="";
                    for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
                        tipoPasajeACanjear = sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPasajero();
                        if(tipoPasajeACanjear.equals("E") || tipoPasajeACanjear.equals("P")){
                            if(!sesionVenta.sonVacaciones()){
                                DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Tipo de pasajero "+tipoPasajeACanjear+" solo esta habilitado<br>en periodo vacacional.</html>", Color.RED);
                                chOk=false;
                                this.dispose();
                                return;
                            }
                        }
                    }
                    
                    importeBolOriginalAdulto = sesionVenta.getTmsBoletosVentaTbl().getImporteBoleto(); 
                    tipoPasajero = sesionVenta.getTmsBoletosVentaTbl().getTipoPasajero();
                    ServicioCH = sesionVenta.getTmsBoletosVentaTbl().getServicio();
                    CiudadCorridaCH = jCboOrigen.getSelectedItem().toString();
                    EmpresaCH = sesionVenta.getTmsBoletosVentaTbl().getEmpresa();
                    chOk=true;
                     conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {

                        for(int i=0; i<boletos.length; i++){
                            try {
                                boletos[i][1] = formatoFechaHora.format(formatoDateServer2.parse(FHc).getTime());
                            } catch (ParseException ex) {
                                DialogoAceptar.mostrarDialogo("¡Corrida con fecha invalida!","Contacte al administrador del sistema.", Color.RED);
                                jTxtFolioPreimpreso.setText("");
                                jTxtNoAsiento.setText("");
                                jCboEmpresas.setSelectedIndex(0);
                                jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();

                                return;
                            }
                        }
                    }
                    verificarEstrellas();
                    xTabla.setDataVector(boletos, encabezado);
                    AnchoColumnas();
                    jTblBoletoOriginal.setRowSelectionInterval(0,0);
                    jTblBoletoOriginal.requestFocusInWindow();
                break;
            case KeyEvent.VK_LEFT:
                    jTxtNoAsiento.selectAll();
                    jTxtNoAsiento.requestFocusInWindow();
                break;
            case KeyEvent.VK_RIGHT:
                    jCboOrigen.requestFocusInWindow();
                break;
        }
    }//GEN-LAST:event_jCboEmpresasKeyPressed

    private void jTxtNoAsientoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTxtNoAsientoKeyPressed
// TODO add your handling code here:
        switch(evt.getKeyCode()){
            case KeyEvent.VK_ESCAPE:
                chOk=false;
                this.dispose();
                break;
            case KeyEvent.VK_ENTER:
                    if(!validaCampos()) return;
                    if(!valMultiTx(jTxtFolioPreimpreso.getText(), jTxtNoAsiento.getText())) return;
                    ConstruyeMultiHo();
                    if(jCboOrigen.getSelectedItem().toString().equals(sesionVenta.getUserCon().getTerminalNombre())) sesionVenta.setTipoTransaccion("L");
                    else sesionVenta.setTipoTransaccion("R");
                    boletos = sesionVenta.buscaBoletoVendidoParaHOMult(jCboOrigen.getSelectedItem().toString(), 
                            conjuntoFolios, conjuntoAsientos, 
                            jCboEmpresas.getSelectedItem().toString().substring(2),
                            jClsSintaxis.getVectorFoliosBoletos().size(),jCboDestino.getSelectedItem().toString(),jchbx_bolConv.isSelected());
                    if(boletos==null){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","No es posible cambiar de horario este boleto.", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                        if(!sonBoletosIgualCorrida()){
                            DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Todos los boletos deben pertenecer<br>a la misma corrida.</html>", Color.RED);
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();
                            return;
                        }
                    
                    if(sesionVenta.getDtFechaDespachoTarjeta()!=null){
                        Date fechaActual = thX;
                        long minutosDespues = sesionVenta.getUserCon().getMinDesCan()*60000;
                        Date fechaCalculada = new Date(sesionVenta.getDtFechaDespachoTarjeta().getTime()+minutosDespues);
                        System.out.println(sesionVenta.getDtFechaDespachoTarjeta().getTime()+" --- "+sesionVenta.getDtFechaDespachoTarjeta());
                        System.out.println(fechaCalculada.getTime()+" --- "+fechaCalculada);
                        System.out.println(fechaActual.getTime()+" --- "+fechaActual);
                        if(fechaActual.getTime()>fechaCalculada.getTime()){
                            DialogoAceptar.mostrarDialogo("¡Tiempo para cambio de horario agotado!","Pida autorizacion del Supervisor.", Color.RED);
                            jDlgAutorizaSupervisor dlg = new jDlgAutorizaSupervisor(sesionVenta,"5006", "Cambiar Horario Boleto");
                            dlg.setVisible(true);
                            if(!dlg.getRespuesta()) return;
                        }
                    }
                    sesionVenta.setTipoTransaccionAuxiliar(sesionVenta.getTipoTransaccion());
                    sesionVenta.setDBLinkAuxiliar(sesionVenta.getDBLink());
                    String FHc = sesionVenta.FechaHoraCorrida();
                    String convenio = (boletos[0][12]==null ?"N":boletos[0][12].toString());
                    if(convenio.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {
                        //System.out.println("FECHA CORRIDA "+FHc);
                        if(FHc==null){
                            DialogoAceptar.mostrarDialogo("¡Corrida sin fecha asociada!","Contacte al administrador del sistema.", Color.RED);
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();
                            return;
                        }
                    }                    
                    // MOD: PARA VARIOS
                    String tipoPasajeACanjear="";
                    for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
                        tipoPasajeACanjear = sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPasajero();
                        if(tipoPasajeACanjear.equals("E") || tipoPasajeACanjear.equals("P")){
                            if(!sesionVenta.sonVacaciones()){
                                DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Tipo de pasajero "+tipoPasajeACanjear+" solo esta habilitado<br>en periodo vacacional.</html>", Color.RED);
                                chOk=false;
                                this.dispose();
                                return;
                            }
                        }
                    }
                    
                    importeBolOriginalAdulto = sesionVenta.getTmsBoletosVentaTbl().getImporteBoleto();
                    tipoPasajero = sesionVenta.getTmsBoletosVentaTbl().getTipoPasajero();
                    ServicioCH = sesionVenta.getTmsBoletosVentaTbl().getServicio();
                    CiudadCorridaCH = jCboOrigen.getSelectedItem().toString();
                    EmpresaCH = sesionVenta.getTmsBoletosVentaTbl().getEmpresa();
                    chOk=true;
                    String conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {
                        for(int i=0; i<boletos.length; i++){
                            try {
                                boletos[i][1] = formatoFechaHora.format(formatoDateServer2.parse(FHc).getTime());
                            } catch (ParseException ex) {
                                DialogoAceptar.mostrarDialogo("¡Corrida con fecha invalida!","Contacte al administrador del sistema.", Color.RED);
                                jTxtFolioPreimpreso.setText("");
                                jTxtNoAsiento.setText("");
                                jCboEmpresas.setSelectedIndex(0);
                                jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();

                                return;
                            }
                        }
                    }
                    verificarEstrellas();                       
                    xTabla.setDataVector(boletos, encabezado);
                    AnchoColumnas();
                    jTblBoletoOriginal.setRowSelectionInterval(0,0);
                    jTblBoletoOriginal.requestFocusInWindow();
                break;
            case KeyEvent.VK_LEFT: case KeyEvent.VK_UP:
                    jTxtFolioPreimpreso.selectAll();
                    jTxtFolioPreimpreso.requestFocusInWindow();
                break;
            case KeyEvent.VK_RIGHT: case KeyEvent.VK_DOWN:
                    jCboEmpresas.requestFocusInWindow();
                break;
        }
    }//GEN-LAST:event_jTxtNoAsientoKeyPressed

    private void jTxtFolioPreimpresoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTxtFolioPreimpresoKeyPressed
// TODO add your handling code here:
        switch(evt.getKeyCode()){
            case KeyEvent.VK_ESCAPE:
                chOk=false;
                this.dispose();
                break;
            case KeyEvent.VK_ENTER:
                    if(!validaCampos()) return;
                    if(!valMultiTx(jTxtFolioPreimpreso.getText(), jTxtNoAsiento.getText())) return;
                    if(!jchbx_bolRef.isSelected())
                    {
                        ConstruyeMultiHo();
                        if(jCboOrigen.getSelectedItem().toString().equals(sesionVenta.getUserCon().getTerminalNombre())) sesionVenta.setTipoTransaccion("L");
                        else sesionVenta.setTipoTransaccion("R");
                        boletos = sesionVenta.buscaBoletoVendidoParaHOMult(jCboOrigen.getSelectedItem().toString(), 
                                conjuntoFolios, conjuntoAsientos, 
                                jCboEmpresas.getSelectedItem().toString().substring(2),
                                jClsSintaxis.getVectorFoliosBoletos().size(),jCboDestino.getSelectedItem().toString(),jchbx_bolConv.isSelected());
                    }
                    else
                    {
                        conjuntoFolios = jTxtFolioPreimpreso.getText().trim();
                        if(vectorTerminal.get(1).toString().equals(sesionVenta.getUserCon().getTerminalNombre())) sesionVenta.setTipoTransaccion("L");
                        else sesionVenta.setTipoTransaccion("R");
                        sesionVenta.setDBLink(vectorTerminal.get(3).toString());
                        sesionVenta.setEsquema(vectorTerminal.get(2).toString()); 
                        CiudadCorridaCH = vectorTerminal.get(1).toString();
                        boletos = sesionVenta.buscaBoletoVendidoParaHOMultRef(vectorTerminal.get(1).toString(), conjuntoFolios);
                    }
                    if(boletos==null){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","No es posible cambiar de horario este boleto.", Color.RED);
                        if(jchbx_bolRef.isSelected())
                        {
                            jTxtFolioPreimpreso.selectAll();
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        }
                        else
                        {
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();

                        }
                        return;
                    }

                    if(!jchbx_bolRef.isSelected())
                    {
                          if(!sonBoletosIgualCorrida()){
                            DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Todos los boletos deben pertenecer<br>a la misma corrida.</html>", Color.RED);
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();
                            return;
                        }
                    }
                    
                    if(sesionVenta.getDtFechaDespachoTarjeta()!=null){
                        Date fechaActual = thX;
                        long minutosDespues = sesionVenta.getUserCon().getMinDesCan()*60000;
                        Date fechaCalculada = new Date(sesionVenta.getDtFechaDespachoTarjeta().getTime()+minutosDespues);
                        System.out.println(sesionVenta.getDtFechaDespachoTarjeta().getTime()+" --- "+sesionVenta.getDtFechaDespachoTarjeta());
                    System.out.println(fechaCalculada.getTime()+" --- "+fechaCalculada);
                        System.out.println(fechaActual.getTime()+" --- "+fechaActual);
                        if(fechaActual.getTime()>fechaCalculada.getTime()){
                            DialogoAceptar.mostrarDialogo("¡Tiempo para cambio de horario agotado!","Pida autorizacion del Supervisor.", Color.RED);
                            jDlgAutorizaSupervisor dlg = new jDlgAutorizaSupervisor(sesionVenta,"5006", "Cambiar Horario Boleto");
                            dlg.setVisible(true);
                            if(!dlg.getRespuesta()) return;
                        }
                    }
                    sesionVenta.setTipoTransaccionAuxiliar(sesionVenta.getTipoTransaccion());
                    sesionVenta.setDBLinkAuxiliar(sesionVenta.getDBLink());
                    String FHc = sesionVenta.FechaHoraCorrida();
                    String conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {
                        //System.out.println("FECHA CORRIDA "+FHc);
                        if(FHc==null){
                            DialogoAceptar.mostrarDialogo("¡Corrida sin fecha asociada!","Contacte al administrador del sistema.", Color.RED);
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();
                            return;
                        }
                    }                    
                    // MOD: PARA VARIOS
                    String tipoPasajeACanjear="";
                    for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
                        tipoPasajeACanjear = sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPasajero();
                        if(tipoPasajeACanjear.equals("E") || tipoPasajeACanjear.equals("P")){
                            if(!sesionVenta.sonVacaciones()){
                                DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Tipo de pasajero "+tipoPasajeACanjear+" solo esta habilitado<br>en periodo vacacional.</html>", Color.RED);
                                chOk=false;
                                this.dispose();
                                return;
                            }
                        }
                    }
                    
                    //Cehca que no sean con tipo de pago SOC
                    this.setRedencionSOC(false);
                    System.out.println("size(): "+sesionVenta.getVariosTmsBoletosVentaTbl().size());
                    for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
                        String tipoPagoACanjear = sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPago();
                        if(tipoPagoACanjear.equals("SOC")){
                            System.out.println("si encontro tipo de pago SOC...");
                            this.setRedencionSOC(true);
                        }
                    }
                    
                    importeBolOriginalAdulto = sesionVenta.getTmsBoletosVentaTbl().getImporteBoleto();
                    tipoPasajero = sesionVenta.getTmsBoletosVentaTbl().getTipoPasajero();
                    ServicioCH = sesionVenta.getTmsBoletosVentaTbl().getServicio();
                    if(!jchbx_bolRef.isSelected())
                        CiudadCorridaCH = jCboOrigen.getSelectedItem().toString();
                    EmpresaCH = sesionVenta.getTmsBoletosVentaTbl().getEmpresa();
                    chOk=true;

//                    for(int i=0; i<boletos.length; i++){
//                        try {
//                            boletos[i][1] = formatoFechaHora.format(formatoDateServer2.parse(FHc).getTime());
//                        } catch (ParseException ex) {
//                            DialogoAceptar.mostrarDialogo("¡Corrida con fecha invalida!","Contacte al administrador del sistema.", Color.RED);
//                            jTxtFolioPreimpreso.setText("");
//                            jTxtNoAsiento.setText("");
//                            jCboEmpresas.setSelectedIndex(0);
//                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
//                        if(jchbx_bolRef.isSelected())
//                            jTxtFolioPreimpreso.requestFocusInWindow();
//                        else    
//                            jCboOrigen.requestFocusInWindow();
//
//                            return;
//                        }
//                    }
                    verificarEstrellas();
                    if(!jchbx_bolRef.isSelected())
                    {
                        xTabla.setDataVector(boletos, encabezado);
                        AnchoColumnas();
                    }
                    else
                    {
                        xTabla.setDataVector(boletos, encabezado2);
                        AnchoColumnas2();
                    }   
                    jTblBoletoOriginal.setRowSelectionInterval(0,0);
                    jTblBoletoOriginal.requestFocusInWindow();
                break;
            case KeyEvent.VK_LEFT: case KeyEvent.VK_UP:
                    if(jCboDestino.isVisible())
                        jCboDestino.requestFocusInWindow();
                    else
                        jchbx_bolConv.requestFocusInWindow();
                break;
            case KeyEvent.VK_RIGHT: case KeyEvent.VK_DOWN:
                    if(jTxtNoAsiento.isEnabled())
                    {
                        jTxtNoAsiento.selectAll();
                        jTxtNoAsiento.requestFocusInWindow();
                    }
                    if(!jTxtNoAsiento.isVisible())
                        jCboOrigen.requestFocus();;
                break;
        }
    }//GEN-LAST:event_jTxtFolioPreimpresoKeyPressed

    
    
    
    private void jCboOrigenKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jCboOrigenKeyPressed
// TODO add your handling code here:
        switch(evt.getKeyCode()){
            case KeyEvent.VK_ESCAPE:
                chOk=false;
                this.dispose();
                break;
            case KeyEvent.VK_ENTER:
                    if(!validaCampos()) return;
                    if(!valMultiTx(jTxtFolioPreimpreso.getText(), jTxtNoAsiento.getText())) return;
                    ConstruyeMultiHo();
                    if(jCboOrigen.getSelectedItem().toString().equals(sesionVenta.getUserCon().getTerminalNombre())) sesionVenta.setTipoTransaccion("L");
                    else sesionVenta.setTipoTransaccion("R");
                    boletos = sesionVenta.buscaBoletoVendidoParaHOMult(jCboOrigen.getSelectedItem().toString(), 
                            conjuntoFolios, conjuntoAsientos, 
                            jCboEmpresas.getSelectedItem().toString().substring(2),
                            jClsSintaxis.getVectorFoliosBoletos().size(),jCboDestino.getSelectedItem().toString(),jchbx_bolConv.isSelected());
                    if(boletos==null){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","No es posible cambiar de horario este boleto.", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(!sonBoletosIgualCorrida()){
                        DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Todos los boletos deben pertenecer<br>a la misma corrida.</html>", Color.RED);
                        jTxtFolioPreimpreso.setText("");
                        jTxtNoAsiento.setText("");
                        jCboEmpresas.setSelectedIndex(0);
                        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                        if(jchbx_bolRef.isSelected())
                            jTxtFolioPreimpreso.requestFocusInWindow();
                        else    
                            jCboOrigen.requestFocusInWindow();
                        return;
                    }
                    
                    if(sesionVenta.getDtFechaDespachoTarjeta()!=null){
                        Date fechaActual = thX;
                        long minutosDespues = sesionVenta.getUserCon().getMinDesCan()*60000;
                        Date fechaCalculada = new Date(sesionVenta.getDtFechaDespachoTarjeta().getTime()+minutosDespues);
                        System.out.println(sesionVenta.getDtFechaDespachoTarjeta().getTime()+" --- "+sesionVenta.getDtFechaDespachoTarjeta());
                        System.out.println(fechaCalculada.getTime()+" --- "+fechaCalculada);
                        System.out.println(fechaActual.getTime()+" --- "+fechaActual);
                        if(fechaActual.getTime()>fechaCalculada.getTime()){
                            DialogoAceptar.mostrarDialogo("¡Tiempo para cambio de horario agotado!","Pida autorizacion del Supervisor.", Color.RED);
                            jDlgAutorizaSupervisor dlg = new jDlgAutorizaSupervisor(sesionVenta,"5006", "Cambiar Horario Boleto");
                            dlg.setVisible(true);
                            if(!dlg.getRespuesta()) return;
                        }
                    }
                    
                    sesionVenta.setTipoTransaccionAuxiliar(sesionVenta.getTipoTransaccion());
                    sesionVenta.setDBLinkAuxiliar(sesionVenta.getDBLink());
                    String FHc = sesionVenta.FechaHoraCorrida();
                    String conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {
                        //System.out.println("FECHA CORRIDA "+FHc);
                        if(FHc==null){
                            DialogoAceptar.mostrarDialogo("¡Corrida sin fecha asociada!","Contacte al administrador del sistema.", Color.RED);
                            jTxtFolioPreimpreso.setText("");
                            jTxtNoAsiento.setText("");
                            jCboEmpresas.setSelectedIndex(0);
                            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();
                            return;
                        }
                    }                    
                    // MOD: PARA VARIOS
                    String tipoPasajeACanjear="";
                    for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
                        tipoPasajeACanjear = sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPasajero();
                        if(tipoPasajeACanjear.equals("E") || tipoPasajeACanjear.equals("P")){
                            if(!sesionVenta.sonVacaciones()){
                                DialogoAceptar.mostrarDialogo("Cambio de horario.","<html>Tipo de pasajero "+tipoPasajeACanjear+" solo esta habilitado<br>en periodo vacacional.</html>", Color.RED);
                                chOk=false;
                                this.dispose();
                                return;
                            }
                        }
                    }
                    
                    importeBolOriginalAdulto = sesionVenta.getTmsBoletosVentaTbl().getImporteBoleto();
                    tipoPasajero = sesionVenta.getTmsBoletosVentaTbl().getTipoPasajero();
                    ServicioCH = sesionVenta.getTmsBoletosVentaTbl().getServicio();
                    CiudadCorridaCH = jCboOrigen.getSelectedItem().toString();
                    EmpresaCH = sesionVenta.getTmsBoletosVentaTbl().getEmpresa();
                    chOk=true;
                     conv = (boletos[0][12] == null ?"N":boletos[0][12].toString());
                    if(conv.equals("S"))
                    {
                        for(int i=0; i<boletos.length; i++){
                            boletos[i][1] = boletos[i][11];
                        }

                    }else
                    {

                        for(int i=0; i<boletos.length; i++){
                            try {
                                boletos[i][1] = formatoFechaHora.format(formatoDateServer2.parse(FHc).getTime());
                            } catch (ParseException ex) {
                                DialogoAceptar.mostrarDialogo("¡Corrida con fecha invalida!","Contacte al administrador del sistema.", Color.RED);
                                jTxtFolioPreimpreso.setText("");
                                jTxtNoAsiento.setText("");
                                jCboEmpresas.setSelectedIndex(0);
                                jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
                            if(jchbx_bolRef.isSelected())
                                jTxtFolioPreimpreso.requestFocusInWindow();
                            else    
                                jCboOrigen.requestFocusInWindow();

                                return;
                            }
                        }
                    }
                    verificarEstrellas();                    
                    xTabla.setDataVector(boletos, encabezado);
                    AnchoColumnas();
                    jTblBoletoOriginal.setRowSelectionInterval(0,0);
                    jTblBoletoOriginal.requestFocusInWindow();
                break;
            
            case KeyEvent.VK_LEFT:
                if(jCboEmpresas.isVisible())
                    jCboEmpresas.requestFocusInWindow();
                else
                {
                    jTxtFolioPreimpreso.selectAll();;
                    jTxtFolioPreimpreso.requestFocus();
                }
                break;
            case KeyEvent.VK_RIGHT:
//                    jTxtFolioPreimpreso.selectAll();
//                    jTxtFolioPreimpreso.requestFocusInWindow();
                      jchbx_bolRef.requestFocus();                
                break;
        }
    }//GEN-LAST:event_jCboOrigenKeyPressed

    private void formComponentShown(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_formComponentShown
// TODO add your handling code here:
        jCboEmpresas.setSelectedIndex(0);
        jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre());
        jCboOrigen.requestFocusInWindow();
    }//GEN-LAST:event_formComponentShown
    
    private boolean validaCampos(){
        if(jCboOrigen.getSelectedItem()==null){
            DialogoAceptar.mostrarDialogo("¡Importante!","Seleccione un origen.", Color.RED);
            jCboOrigen.setSelectedItem(sesionVenta.getUserCon().getTerminalNombre()); jCboOrigen.requestFocusInWindow(); return false;
        }
        if(jTxtFolioPreimpreso.getText().equals("")){
            if(jchbx_bolRef.isSelected())
                DialogoAceptar.mostrarDialogo("¡Importante!","Ingrese la referencia del boleto.", Color.RED);
            else
                DialogoAceptar.mostrarDialogo("¡Importante!","Ingrese Folio Preimpreso del Boleto.", Color.RED);
            jTxtFolioPreimpreso.requestFocusInWindow(); return false;
        }
        if(jTxtNoAsiento.getText().equals("") && !jchbx_bolRef.isSelected() && !jchbx_bolConv.isSelected()){
            DialogoAceptar.mostrarDialogo("¡Importante!","Ingrese Numero de Asiento.", Color.RED);
            jTxtNoAsiento.requestFocusInWindow(); return false;
        }
        if(jCboEmpresas.getSelectedItem()==null){
            DialogoAceptar.mostrarDialogo("¡Importante!","Seleccione una empresa.", Color.RED);
            jCboEmpresas.setSelectedIndex(0); return false;
        }
        return true;
    }
    
    private void ordenaListaEmpresas(){
        Object[] objs= new Object[objEmpresas.length];
        int i, j, vA, vB; String valor;
        for(i=0; i<objEmpresas.length; i++){
            for(j=0; j<objEmpresas.length-1; j++){
                valor=objEmpresas[j+1].toString();
                vA=Integer.valueOf(objEmpresas[j].toString().substring(0,1));
                vB=Integer.valueOf(objEmpresas[j+1].toString().substring(0,1));
                if(vA>vB){
                    objEmpresas[j+1] = objEmpresas[j].toString();
                    objEmpresas[j] = valor;
                }
            }
        }
    }
    
    private void AnchoColumnas() {
        int anchoContenedor = jScpBoletoOriginal.getWidth();
        TableColumn column;
        for (int i = 0; i < jTblBoletoOriginal.getColumnCount(); i++) {
            column = jTblBoletoOriginal.getColumnModel().getColumn(i);
            switch (i) {
                case 0: column.setPreferredWidth(Math.round(anchoContenedor*(float)0.12)); break;
                case 1: column.setPreferredWidth(Math.round(anchoContenedor*(float)0.15)); break;
                case 2: column.setPreferredWidth(Math.round(anchoContenedor*(float)0.04)); break;
                case 3: column.setPreferredWidth(Math.round(anchoContenedor*(float)0.04)); break;
                case 4: column.setPreferredWidth(Math.round(anchoContenedor*(float)0.35)); break;
                case 5: column.setPreferredWidth(Math.round(anchoContenedor*(float)0.14)); break;
                case 6: column.setPreferredWidth(Math.round(anchoContenedor*(float)0.08)); break;
                case 7: column.setPreferredWidth(Math.round(anchoContenedor*(float)0.08)); break;
            }
            column.setResizable(false);
        }
       jScpBoletoOriginal.setFont(new java.awt.Font("Tahoma", 1, 10));
        jTblBoletoOriginal.setFont(new java.awt.Font("Tahoma", 1, 10));        
    }
    
     private void AnchoColumnas2() {
        int anchoContenedor = jScpBoletoOriginal.getWidth();
        TableColumn column;
        for (int i = 0; i < jTblBoletoOriginal.getColumnCount(); i++) {
            column = jTblBoletoOriginal.getColumnModel().getColumn(i);
            switch (i) {
                case 0: column.setMinWidth( 120 );column.setMaxWidth( 120 );column.setPreferredWidth(120); break;
                case 1: column.setMinWidth( 110 );column.setMaxWidth( 110 );column.setPreferredWidth(110); break;
                case 2: column.setMinWidth( 20 );column.setMaxWidth(20  );column.setPreferredWidth(20); break;
                case 3: column.setMinWidth( 20 );column.setMaxWidth( 20 );column.setPreferredWidth(20); break;
                case 4: column.setMinWidth( 60 );column.setMaxWidth( 60 );column.setPreferredWidth(60); break;
                case 5: column.setMinWidth( 60 );column.setMaxWidth( 50 );column.setPreferredWidth(50); break;
                case 6: column.setMinWidth( 50 );column.setMaxWidth( 60 );column.setPreferredWidth(60); break;
                case 7: column.setMinWidth( 220 );column.setMaxWidth( 220 );column.setPreferredWidth(220); break;
                case 8: column.setMinWidth( 220 );column.setMaxWidth( 220 );column.setPreferredWidth(220); break;
                case 9: column.setMinWidth( 60 );column.setMaxWidth( 60 );column.setPreferredWidth(60); break;
                case 10: column.setMinWidth( 0 );column.setMaxWidth( 0 );column.setPreferredWidth(0); break;
                case 11: column.setMinWidth( 0 );column.setMaxWidth( 0 );column.setPreferredWidth(0); break;
                case 12: column.setMinWidth( 0 );column.setMaxWidth( 0 );column.setPreferredWidth(0); break;
                case 13: column.setMinWidth( 0 );column.setMaxWidth( 0 );column.setPreferredWidth(0); break;
            }
            column.setResizable(false);
        }
       jScpBoletoOriginal.setFont(new java.awt.Font("Tahoma", 1, 10));
        jTblBoletoOriginal.setFont(new java.awt.Font("Tahoma", 1, 10));        
    }    
    
    
    private boolean valMultiTx(String folios, String asientos) {
        if(!jchbx_bolRef.isSelected())
        {
            int r=jClsSintaxis.Valfolios(folios);
            if(r!=0){
                if(r==-1) DialogoAceptar.mostrarDialogo("Folios incorrectos","<html>Ingrese correctamente los folios.<br>" +
                                                        "Ejemplo, 21448001-21448005 21448009.</html>",Color.RED);
                else if(r==1) DialogoAceptar.mostrarDialogo("Folios incorrectos",
                                "<html>Algun folio tiene mas de 10 digitos.</html>",Color.RED);
                else  DialogoAceptar.mostrarDialogo("Folios incorrectos","<html>Folio inicial no puede ser<br>mayor o igual que folio final</html>",Color.RED);
                jTxtFolioPreimpreso.selectAll();
                jTxtFolioPreimpreso.requestFocusInWindow();
                return false;
            }
            if(!jClsSintaxis.ValAsientos(asientos)){
                DialogoAceptar.mostrarDialogo("Asientos incorrectos","Ingrese correctamente los numeros de asiento.",Color.RED);
                jTxtNoAsiento.selectAll();
                jTxtNoAsiento.requestFocusInWindow();
                return false;
            }

            if(jClsSintaxis.getVectorFoliosBoletos().size()!=jClsSintaxis.getVectorAsientos().size() && !jchbx_bolConv.isSelected()){       
                DialogoAceptar.mostrarDialogo("Datos incorrectos","Cantidad de asientos y folios no es el mismo.",Color.RED);
                jTxtFolioPreimpreso.setText("");
                jTxtNoAsiento.setText("");
                jTxtFolioPreimpreso.requestFocusInWindow();
                return false;
            }
         return true;
        }
        else
        {
            int nter = 0;
            try {
                nter = Integer.parseInt(folios.substring(0, 2), 16);
            } catch (NumberFormatException ex) {
                ex.printStackTrace();
            }
            Vector vter = sesionVenta.buscaTerminalRef(nter) ;
            if(vter.size()==0){
                DialogoAceptar.mostrarDialogo("¡Imposible realizar canje!","<html>Puede ser que la referencia sea incorrecta o<br>" +
                        "el boleto(s) ya fue canjeado.</html>", Color.RED);
                jTxtFolioPreimpreso.selectAll();
                jTxtFolioPreimpreso.requestFocusInWindow();
                return false;
            }
            this.vectorTerminal = (Vector) vter.get(0);
            return true;
        }        
    }
    
    private void ConstruyeMultiHo(){
     if(!jchbx_bolConv.isSelected())
     {
        conjuntoFolios="'"+jClsSintaxis.getVectorFoliosBoletos().get(0).toString()+"'";
        conjuntoAsientos="'"+jClsSintaxis.getVectorAsientos().get(0).toString()+"'";
            for(int i=1; i<jClsSintaxis.getVectorFoliosBoletos().size(); i++){
                conjuntoFolios=conjuntoFolios+",'"+jClsSintaxis.getVectorFoliosBoletos().get(i).toString()+"'";
                conjuntoAsientos=conjuntoAsientos+",'"+jClsSintaxis.getVectorAsientos().get(i).toString()+"'";
            }
     }
     else
     {
        conjuntoFolios="'"+jClsSintaxis.getVectorFoliosBoletos().get(0).toString()+"'";
        conjuntoAsientos="'"+1+"'";
            for(int i=1; i<jClsSintaxis.getVectorFoliosBoletos().size(); i++){
                conjuntoFolios=conjuntoFolios+",'"+jClsSintaxis.getVectorFoliosBoletos().get(i).toString()+"'";
                conjuntoAsientos=conjuntoAsientos+",'"+(i+1)+"'";
            }
     System.out.println("conjuntoFolios(HO): "+conjuntoFolios);
     System.out.println("conjuntoAsientos(HO): "+conjuntoAsientos);

     }
    }
    
    private boolean sonBoletosIgualCorrida(){
        for(int i=1; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++)
            if(!sesionVenta.getTmsBoletosVentaTbl().getClaveCorrida().equals(sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getClaveCorrida()) ||
                !sesionVenta.getTmsBoletosVentaTbl().getCiudadVenta().equals(sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getCiudadVenta()))
                return false;
        return true;
    }
    
    private boolean sonBoletosReferenIgualCorrid(){
        Vector ncorridas = new Vector();
        for(int i=0; i<jTblBoletoOriginal.getRowCount();i++)
        {
            if(jTblBoletoOriginal.getValueAt(i,9).toString().equals("S") )
            {
                if(ncorridas.size()==0)
                    ncorridas.add(sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getClaveCorrida().toString());
                else
                {
                    int index = ncorridas.indexOf(sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getClaveCorrida().toString());
                    if(index == -1)
                            ncorridas.add(sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getClaveCorrida());
                }
                
            }
        }
        
        if(ncorridas.size()>1)
            return false;
        else
            return true;
    }    
    
    private void interfazColor(){
        jPanel1.setBackground(ColoresInterfaz.cFondoDialogo);
        jLabel4.setForeground(ColoresInterfaz.cTextoAyuda1);
        jScpBoletoOriginal.setBackground(ColoresInterfaz.cFondoDialogo);
        jTblBoletoOriginal.setBackground(ColoresInterfaz.cFondoDialogo);
        
        setFont(ColoresInterfaz.fuente1);
        jLabel1.setFont(ColoresInterfaz.fuente1);
        jCboOrigen.setFont(ColoresInterfaz.fuente1);
        jlbl_folRef.setFont(ColoresInterfaz.fuente1);
        jTxtFolioPreimpreso.setFont(ColoresInterfaz.fuente1);
        jLabel3.setFont(ColoresInterfaz.fuente1);
        jTxtNoAsiento.setFont(ColoresInterfaz.fuente1);
        jLabel5.setFont(ColoresInterfaz.fuente1);
        jCboEmpresas.setFont(ColoresInterfaz.fuente1);
        jTblBoletoOriginal.setFont(ColoresInterfaz.fuente1);
        jLabel4.setFont(ColoresInterfaz.fuente1);
    }
    public boolean isReferenciado()
    {
        return jchbx_bolRef.isSelected();
    }
    
    public String getReferencia()
    {
        return jTxtFolioPreimpreso.getText();
    }
    
    public String getBoletoReferenciadoId(){
        return sesionVenta.getVariosTmsBoletosVentaTbl().get(0).getBolReferenciadoId();
    }
    
    private void verificarEstrellas(){
        for(int i=0; i<sesionVenta.getVariosTmsBoletosVentaTbl().size(); i++){
            System.out.println("Folio : "+sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getFolioPreimpreso());
            System.out.println("Ciudad Venta : "+sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getCiudadVenta());
            System.out.println("Referencia : "+sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getAdicional8());
            System.out.println("Num Tarjeta: "+sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getAdicional9());
            System.out.println("Tipo Pago: "+sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPago());
            if(sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPago().equals("SOC")){
                            System.out.println("si encontro tipo de pago SOC...");
                            this.setRedencionSOC(true);
            }
            if(sesionVenta.getTiposPagoLealtad().indexOf(sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getTipoPago())>=0) this.setExisteLealtad(true);
            //this.setNumTarLeal((( sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getAdicional9() == null ?"" :sesionVenta.getVariosTmsBoletosVentaTbl().get(i).getAdicional9().toString())));
        }      
        Vector v = sesionVenta.buscaRegistroLealtadAcumHO();
        if(v.size()==0)
            this.setNumTarLeal("");
        else
        {
            Vector vv = (Vector)v.get(0);
            this.setNumTarLeal(vv.get(0).toString());
        } 
        System.out.println("Num Tarjeta(General H0): "+this.getNumTarLeal());
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox jCboDestino;
    private javax.swing.JComboBox jCboEmpresas;
    private javax.swing.JComboBox jCboOrigen;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScpBoletoOriginal;
    private javax.swing.JTable jTblBoletoOriginal;
    private javax.swing.JTextField jTxtFolioPreimpreso;
    private javax.swing.JTextField jTxtNoAsiento;
    private javax.swing.JCheckBox jchbx_bolConv;
    private javax.swing.JCheckBox jchbx_bolRef;
    private javax.swing.JLabel jlbl_folRef;
    // End of variables declaration//GEN-END:variables
    public Object[][] boletos = null;
    public static boolean chOk=false;
    public String ServicioCH="";
    public String EmpresaCH="";
    public String CiudadCorridaCH="";
    public double importeBolOriginalAdulto=0;
    public String tipoPasajero="";
    private SesionVenta sesionVenta = null;
    private JDlgAceptar DialogoAceptar = new JDlgAceptar();
    private Object[] objEmp;
    private Object[] objEmpresas;
    private SimpleDateFormat formatoFechaHora = new SimpleDateFormat("dd/MM/yyyy HH:mm");
    private SimpleDateFormat formatoDateServer2 = new SimpleDateFormat("yyyy-MM-dd HH:mm");
    private JClsColoresInterfaz ColoresInterfaz = new JClsColoresInterfaz();
    private Date thX=null;
    private Object[] encabezado = {"CORRIDA", "FECHA CORRIDA", "#", "T", "NOMBRE", "ORIGEN", "DESTINO", "COSTO"};
    private Object[] encabezado2 = {"CORRIDA","FECHA CORRIDA", "#", "T", "ORIGEN", "DESTINO","COSTO"  , "NOMBRE PASAJERO","NOMBRE AUTORIZADO","CAMBIAR","DOCUMENTO","FOLIO","TIPO","EMPRESA"};
    private DefaultTableModel xTabla = new DefaultTableModel(null,encabezado){
        public boolean isCellEditable(int row, int col){
            return false;
        }
    };
    private JClsSintaxis jClsSintaxis=null;
    private String conjuntoFolios;
    private String conjuntoAsientos;
    private Color xorColorFondo = new Color(156, 179, 201);
    private Vector vectorTerminal;
    private boolean existeLealtad = false;
    
    public String getNumTarLeal() {
        return numTarLeal;
    }

    public void setNumTarLeal(String numTarLeal) {
        this.numTarLeal = numTarLeal;
    }

    public boolean isExisteLealtad() {
        return existeLealtad;
    }

    public void setExisteLealtad(boolean existeLealtad) {
        this.existeLealtad = existeLealtad;
    }

    public boolean isRedencionSOC() {
        return redencionSOC;
    }

    public void setRedencionSOC(boolean predencionSOC) {
        this.redencionSOC = predencionSOC;
    }
}